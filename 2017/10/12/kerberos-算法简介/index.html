<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>kerberos 算法简介 | zsh同学的笔记簿</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Kerberos 简介 它是 authentication protocol, 只管认证, 不管授权(authorization). 可以实现单点登录 (single sign-on authentication), 一个密码, 认证所有 service. work over untrusted networks. work between trusted systems. 默认使用 UDP po">
<meta name="keywords" content="kerberos,algorithm,authentication">
<meta property="og:type" content="article">
<meta property="og:title" content="kerberos 算法简介">
<meta property="og:url" content="http://zsh-89.github.io/2017/10/12/kerberos-算法简介/index.html">
<meta property="og:site_name" content="zsh同学的笔记簿">
<meta property="og:description" content="Kerberos 简介 它是 authentication protocol, 只管认证, 不管授权(authorization). 可以实现单点登录 (single sign-on authentication), 一个密码, 认证所有 service. work over untrusted networks. work between trusted systems. 默认使用 UDP po">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2017-10-13T03:02:46.002Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="kerberos 算法简介">
<meta name="twitter:description" content="Kerberos 简介 它是 authentication protocol, 只管认证, 不管授权(authorization). 可以实现单点登录 (single sign-on authentication), 一个密码, 认证所有 service. work over untrusted networks. work between trusted systems. 默认使用 UDP po">
  
    <link rel="alternate" href="/atom.xml" title="zsh同学的笔记簿" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">zsh同学的笔记簿</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://zsh-89.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-kerberos-算法简介" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/10/12/kerberos-算法简介/" class="article-date">
  <time datetime="2017-10-12T11:37:20.000Z" itemprop="datePublished">2017-10-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      kerberos 算法简介
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Kerberos-简介"><a href="#Kerberos-简介" class="headerlink" title="Kerberos 简介"></a>Kerberos 简介</h2><ul>
<li>它是 authentication protocol, 只管认证, 不管授权(authorization).</li>
<li>可以实现单点登录 (single sign-on authentication), 一个密码, 认证所有 service.</li>
<li>work over untrusted networks.</li>
<li>work between trusted systems.</li>
<li>默认使用 UDP port: 88</li>
<li>Kerberos 一定不会发送任何密码 (或密码的 hash, 或 key), 即使是加密过的密码 (或加密过的密码 hash) 也绝不会发送;</li>
<li>使用 “对称加密” 保证通信安全;</li>
</ul>
<p>据说在企业内部系统的 authentication, kerberos 的应用是极其广泛的, 并没有特别值得一题的竞品.</p>
<h2 id="Kerberos-验证身份的思路"><a href="#Kerberos-验证身份的思路" class="headerlink" title="Kerberos 验证身份的思路"></a>Kerberos 验证身份的思路</h2><p>kerberos 协议中互相通信的实体:<br>client, server, AS (kerberos authentication service), TGS (kerberos ticket granting service)  </p>
<p>kerberos 协议的目标: </p>
<ul>
<li>使得 client 和 server 之间可以互相确认身份 (authentication);<br>一旦 kerberos 认证成功, client 和 server 都可以确定它们在和可信真实的对象打交道.<br>server 可以放心地对 client 提供 application service, 开放敏感数据; client 也不必担心 server 是假冒的</li>
<li>client 和 server 之间将会共同得到一个 <code>app-service session key</code>,<br>之后它们之间的通信将通过这个 key 和对称加密算法保证安全性, 不被第三方窃听</li>
</ul>
<p>TGT: 可以认为是一个 “长效证件”, 在它失效之前, client 都不必重新找 AS 再次认证.<br>client key: 一般来说是 “client 密码的 hash”, 只有 client 和 AS 知道 (后面的 server key 同理).</p>
<p>client 向 AS 自证身份, 得到 TGT: </p>
<ul>
<li>client 向 AS 发送: <code>username</code> 和 <code>用 client key 加密的 timestamp</code>.  </li>
<li>AS 在 DB 中找到 client key, 尝试解密收到的密文;<br>如果解密成功, 并且得到有效的时间戳, 则 <strong>client 就成功地向 AS 证明了自己的身份</strong>.<br>(这是典型的 kerberos 式的 “通过解密验证身份”)<br>(加密的内容为什么选择时间戳: 通过时间戳来杜绝 “重放攻击”)</li>
<li>AS 向已验明正身的 client 发送 TGT.<br>TGT 本身是一串密文, 只有 TGS 才能解密.<br>同时也发送 <code>TGS session key</code> (用 client key 加密).<br>之后 client 和 TGS 之间的通信, 将用这个 TGS session key 保证通信安全</li>
<li>client 收到 TGT, 并通过 client key 解密得到 <code>TGS session key</code> </li>
</ul>
<p>当 client 需要和 server 建立通信时:</p>
<ul>
<li>client 向 TGS 发送 TGT (英文: client just blindly send TGT to TGS).<br>注意: TGT 本身已经是密文, 故 client 不需要对其做处理</li>
<li>TGS 收到 TGT, 进行解密 (注意, 前面提到: 只有 TGS 才能解读作为密文的 TGT);<br>如果得到有效信息, <strong>client 就向 TGS 证明了自己的身份</strong> (典型的 kerberos 式的 “通过解密验证身份”)</li>
<li>TGS 向 client 发送两份加密信息:<br><code>用 TGS session key 加密的 app-service session key</code> 和 <code>app service ticket (本身是密文, 用 server key 加密过)</code><br>其中, <code>app-service session key</code> 在认证成功之后, 将被用于将来 client 和 server 间通信的加密</li>
<li>client 将本身是密文的 <code>app-service ticket</code> 发送给 server<br>(英文: blindly send <code>app-service ticket</code> to server);<br>并且, 通过 <code>TGS session key</code> 解开密文, 得到 <code>app-service session key</code></li>
<li>server 将尝试用自身的 server key 对作为密文的 <code>app-service ticket</code> 解密, 如果解密成功,<br><strong>client 就向 server 证明了自己的身份</strong> (典型的 kerberos 式的 “通过解密验证身份”)</li>
<li>server 从解密后的 <code>app service ticket</code> 得到 <code>app service session key</code>,<br>利用它加密 timestamp 发送给 client</li>
<li>client 尝试通过 <code>app service session key</code> 对收到的密文解密, 如果得到有效的 timestamp,<br>则 <strong>server 向 client 证明了自己的身份</strong></li>
<li>认证完毕, client 和 server 之后将使用 <code>app service session key</code> 加密它们之间的通信</li>
</ul>
<p>注意:</p>
<ul>
<li>client 向 AS 自证身份的道具, 是用自己的 key 给 timestamp 加密的密文; 因为只有 AS 才也知道 client key</li>
<li>client 向 server 自证身份的道具, 用的是 TGS 给的 <code>app-service ticket</code>;<br>这个 ticket 是 TGS 帮忙用 server key 加密好的;</li>
<li>server 向 client 自证身份的道具,<br>是用自己从 <code>app-service ticket</code> 解密出来的 <code>app service session key</code> (用它加密一个时间戳)</li>
</ul>
<h4 id="小细节"><a href="#小细节" class="headerlink" title="小细节"></a>小细节</h4><p>实际上, client 在发送 <code>app-service ticket</code> 给 server 的时候, 还发送了被加密的 authenticator.<br>因为 server 需要一个办法知道解密得到的 <code>app-service ticket</code> 确实是有效的; </p>
<p>解决方法:<br>authenticator 是被 <code>app-service session key</code> 加密的, authenticator 中包含时间戳.<br>server 用从 <code>app-service ticket</code> 中得到的 <code>app-service session key</code> 解密 authenticator,<br>检查能否得到有效的时间戳, 即可.</p>
<p>不过, 这只是多种验证 <code>app-service ticket</code> 方法中的一种, 不是 kerberos 算法思路的核心.<br>可以发现, 每一步 “验证身份” 的过程都包括了 “发送和验证有效的时间戳”, 这样才能杜绝重放攻击.</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="http://web.mit.edu/tsitkova/www/build/index.html" target="_blank" rel="external">http://web.mit.edu/tsitkova/www/build/index.html</a> Kerb 的文档都在这里.</li>
<li>Simon Wilkinson, Kerberos Tutorial</li>
<li><a href="https://msdn.microsoft.com/en-us/library/bb742516.aspx" target="_blank" rel="external">https://msdn.microsoft.com/en-us/library/bb742516.aspx</a> kerberos explained 重点分明, 把核心介绍得清楚, 略去不少细节</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://zsh-89.github.io/2017/10/12/kerberos-算法简介/" data-id="cj8pkvky00005qzurhr0qsanj" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/algorithm/">algorithm</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/authentication/">authentication</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/kerberos/">kerberos</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/10/13/kerberos-prestash-简介-自动更新-TGT-的机制/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          kerberos pre-stash 简介: 自动更新 TGT 的机制
        
      </div>
    </a>
  
  
    <a href="/2017/08/14/使用-hexo-建立-github-io-个人-blog/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">使用 hexo 建立 github.io 个人 blog</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/algorithm/">algorithm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/authentication/">authentication</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git-submodule/">git submodule</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github-io-个人-blog/">github.io 个人 blog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kerberos/">kerberos</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pre-stash/">pre-stash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/set-cover-problem/">set cover problem</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/algorithm/" style="font-size: 20px;">algorithm</a> <a href="/tags/authentication/" style="font-size: 10px;">authentication</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/git-submodule/" style="font-size: 10px;">git submodule</a> <a href="/tags/github-io-个人-blog/" style="font-size: 10px;">github.io 个人 blog</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/kerberos/" style="font-size: 20px;">kerberos</a> <a href="/tags/pre-stash/" style="font-size: 10px;">pre-stash</a> <a href="/tags/set-cover-problem/" style="font-size: 10px;">set cover problem</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/10/13/kerberos-prestash-简介-自动更新-TGT-的机制/">kerberos pre-stash 简介: 自动更新 TGT 的机制</a>
          </li>
        
          <li>
            <a href="/2017/10/12/kerberos-算法简介/">kerberos 算法简介</a>
          </li>
        
          <li>
            <a href="/2017/08/14/使用-hexo-建立-github-io-个人-blog/">使用 hexo 建立 github.io 个人 blog</a>
          </li>
        
          <li>
            <a href="/2017/08/10/git-submodule-配置查看-submodule-的具体版本/">git submodule: 配置查看 submodule 的具体版本</a>
          </li>
        
          <li>
            <a href="/2017/07/17/实现权限分配遇到的算法问题-简化的-set-cover-problem/">实现权限分配遇到的算法问题: 简化的 set cover problem</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 zsh同学<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>